# Уведомления о новых заказах в Telegram

Система может отправлять уведомления о новых заказах в Telegram-чат для курьеров.

## Настройка

### 1. Создание бота

1. Напишите [@BotFather](https://t.me/BotFather) в Telegram
2. Отправьте команду `/newbot`
3. Введите имя и username бота
4. Сохраните полученный **токен** (например, `123456789:ABCdefGHIjklMNOpqrsTUVwxyz`)

### 2. Добавление бота в чат курьеров

1. Создайте групповой чат для курьеров или используйте существующий
2. Добавьте бота в чат как участника (через меню «Добавить участников»)
3. При необходимости дайте боту права на отправку сообщений

### 3. Получение Chat ID

**Для группы:**
- Добавьте в чат бота [@userinfobot](https://t.me/userinfobot) или [@getidsbot](https://t.me/getidsbot)
- Напишите любое сообщение — бот покажет ID чата (например, `-1001234567890`)

**Альтернатива:** отправьте сообщение в группу, затем откройте в браузере:
```
https://api.telegram.org/bot<ВАШ_ТОКЕН>/getUpdates
```
В ответе найдите `"chat":{"id":-1001234567890,...}`

### 4. Конфигурация приложения

Уведомления можно отправлять **в несколько чатов** — укажите все chat ID. При добавлении бота в новый чат получите его ID и добавьте в список (Telegram не даёт боту получить список чатов автоматически).

Переменные окружения:

```bash
export TELEGRAM_BOT_TOKEN="123456789:ABCdefGHIjklMNOpqrsTUVwxyz"
# Один чат:
export TELEGRAM_CHAT_ID="-1001234567890"
# Или несколько чатов через запятую:
export TELEGRAM_CHAT_IDS="-1001234567890,-1009876543210"
```

В `application.yaml`:

```yaml
telegram:
  bot:
    token: "123456789:ABCdefGHIjklMNOpqrsTUVwxyz"
    chat-id: "-1001234567890"   # один чат (необязательно)
    chat-ids: "-1001,-1002,-1003"  # все чаты, куда слать (через запятую)
```

Используются все уникальные ID из `chat-id` и `chat-ids` вместе.

## Формат уведомления

При создании нового заказа в чат отправляется сообщение с:

- Номером заказа
- Городом (Парнас / Ухта)
- Типом заказа (Доставка / Самовывоз)
- Адресом и комментарием (для доставки)
- Телефоном клиента
- Способом оплаты
- Временем начала приготовления и готовности
- Списком позиций

## Отключение

Если не заданы `TELEGRAM_BOT_TOKEN` или ни один chat ID (`TELEGRAM_CHAT_ID` / `TELEGRAM_CHAT_IDS`), уведомления не отправляются. Приложение работает как обычно.
